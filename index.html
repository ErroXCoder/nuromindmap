<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktive Mindmap</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        canvas {
            display: block;
        }
        #controls {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-width: 300px;
            display: none;
        }
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            display: none;
            pointer-events: none;
            font-size: 14px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input, button {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #007BFF;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #toggleControls {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 10px;
            background: #007BFF;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        #darkModeToggle {
            position: fixed;
            bottom: 10px;
            left: 10px;
            padding: 10px;
            background: #333;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
<canvas id="networkCanvas"></canvas>
<div id="tooltip"></div>

<div id="controls">
    <h3>Knoten bearbeiten/hinzufügen</h3>
    <label for="nodeLabel">Bezeichnung</label>
    <input type="text" id="nodeLabel" placeholder="Knotenname">
    <label for="nodeColor">Farbe</label>
    <input type="color" id="nodeColor" value="#007BFF">
    <label for="nodeCategory">Kategorie</label>
    <input type="text" id="nodeCategory" placeholder="Kategorie">
    <button id="addNode">Knoten hinzufügen</button>
    <button id="saveNode">Speichern</button>
    <button id="deleteNode">Knoten löschen</button>
    <h3>Verbindung hinzufügen</h3>
    <label for="sourceNode">Startknoten-ID</label>
    <input type="number" id="sourceNode" placeholder="Start-ID">
    <label for="targetNode">Zielknoten-ID</label>
    <input type="number" id="targetNode" placeholder="Ziel-ID">
    <label for="linkColor">Verbindungsfarbe</label>
    <input type="color" id="linkColor" value="#cccccc">
    <button id="addLink">Verbindung hinzufügen</button>
</div>

<div id="toggleControls">Bearbeitungsmenü</div>
<div id="darkModeToggle">Dark Mode</div>

<script>
    const canvas = document.getElementById('networkCanvas');
    const ctx = canvas.getContext('2d');
    const tooltip = document.getElementById('tooltip');
    const controls = document.getElementById('controls');
    const toggleControls = document.getElementById('toggleControls');
    const darkModeToggle = document.getElementById('darkModeToggle');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let nodes = [
        { id: 1, x: 300, y: 300, label: "Hauptknoten", color: "#007BFF", category: "Haupt" }
    ];
    let links = [];
    let selectedNode = null;
    let isDragging = false;

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Kategorie-Transparenzverbindungen zeichnen
        const categories = {};
        nodes.forEach(node => {
            if (!categories[node.category]) categories[node.category] = [];
            categories[node.category].push(node);
        });

        Object.values(categories).forEach(categoryNodes => {
            ctx.beginPath();
            ctx.strokeStyle = "rgba(0, 0, 255, 0.1)";
            ctx.lineWidth = 1;
            categoryNodes.forEach((node, index) => {
                if (index > 0) {
                    ctx.moveTo(categoryNodes[index - 1].x, categoryNodes[index - 1].y);
                    ctx.lineTo(node.x, node.y);
                }
            });
            ctx.stroke();
        });

        // Links zeichnen
        links.forEach(link => {
            const source = nodes.find(node => node.id === link.source);
            const target = nodes.find(node => node.id === link.target);
            if (source && target) {
                ctx.beginPath();
                ctx.moveTo(source.x, source.y);
                ctx.lineTo(target.x, target.y);
                ctx.strokeStyle = link.color || "#ccc";
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        });

        // Knoten zeichnen
        nodes.forEach(node => {
            ctx.beginPath();
            ctx.arc(node.x, node.y, 20, 0, Math.PI * 2);
            ctx.fillStyle = node.color;
            ctx.fill();
            ctx.strokeStyle = "#ffffff";
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.fillStyle = "#fff";
            ctx.textAlign = "center";
            ctx.font = "14px Arial";
            ctx.fillText(node.label, node.x, node.y + 4);
        });
    }

    canvas.addEventListener('mousedown', (event) => {
        const pos = { x: event.offsetX, y: event.offsetY };
        selectedNode = nodes.find(node => {
            const dx = pos.x - node.x;
            const dy = pos.y - node.y;
            return Math.sqrt(dx * dx + dy * dy) < 20;
        });

        if (selectedNode) {
            document.getElementById('nodeLabel').value = selectedNode.label;
            document.getElementById('nodeColor').value = selectedNode.color;
            document.getElementById('nodeCategory').value = selectedNode.category;
            controls.style.display = 'block';
            isDragging = true;
        }
    });

    canvas.addEventListener('mousemove', (event) => {
        if (isDragging && selectedNode) {
            selectedNode.x = event.offsetX;
            selectedNode.y = event.offsetY;
            draw();
        }
    });

    canvas.addEventListener('mouseup', () => {
        isDragging = false;
    });

    document.getElementById('addNode').addEventListener('click', () => {
        const label = document.getElementById('nodeLabel').value || `Knoten ${nodes.length + 1}`;
        const color = document.getElementById('nodeColor').value || "#007BFF";
        const category = document.getElementById('nodeCategory').value || "Allgemein";

        const newNode = {
            id: nodes.length + 1,
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            label,
            color,
            category
        };
        nodes.push(newNode);
        draw();
    });

    document.getElementById('addLink').addEventListener('click', () => {
        const source = parseInt(document.getElementById('sourceNode').value);
        const target = parseInt(document.getElementById('targetNode').value);
        const color = document.getElementById('linkColor').value;

        if (source && target && source !== target) {
            const newLink = { source, target, color };
            links.push(newLink);
            draw();
        }
    });

    document.getElementById('saveNode').addEventListener('click', () => {
        if (selectedNode) {
            selectedNode.label = document.getElementById('nodeLabel').value;
            selectedNode.color = document.getElementById('nodeColor').value;
            selectedNode.category = document.getElementById('nodeCategory').value;
            draw();
        }
    });

    document.getElementById('deleteNode').addEventListener('click', () => {
        if (selectedNode) {
            nodes = nodes.filter(node => node !== selectedNode);
            links = links.filter(link => link.source !== selectedNode.id && link.target !== selectedNode.id);
            selectedNode = null;
            controls.style.display = 'none';
            draw();
        }
    });

    toggleControls.addEventListener('click', () => {
        controls.style.display = controls.style.display === 'block' ? 'none' : 'block';
    });

    darkModeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        const isDarkMode = document.body.classList.contains('dark-mode');
        document.body.style.backgroundColor = isDarkMode ? '#121212' : '#ffffff';
        document.body.style.color =document.body.style.color = isDarkMode ? '#ffffff' : '#000000';
    });

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        draw();
    });

    draw();
</script>
</body>
</html>
